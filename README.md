# ApplicationCenter

# Инструкция по работе с системой подачи и обработки заявок

## Общая структура проекта

Проект включает следующие компоненты:

- **Фронтенд (интерфейс)** – HTML/JS-интерфейс, расположенный в папке `wwwroot`:
  - `/index.html` – пользовательская панель подачи заявок
  - `/admin/index.html` – админ-панель для обработки заявок

- **Бэкенд (ASP.NET Core Web API)**:
  - Контроллеры: `RegistrationController`, `AuthorizationController`, `ApplicationsController`, `AdminController`
  - Работа с БД через EF Core (`ApplicationCenterContext`)
  - Хранение файлов и XML-документов

---

## 1. Регистрация пользователя

### Где:
- Страница регистрации: `register.html`

### Что делает пользователь:
1. Вводит ФИО, Email, Телефон, Адрес, Место работы, Логин и Пароль.
2. Нажимает кнопку **"Зарегистрироваться"**.

### Что происходит:
- Отправляется POST-запрос на `api/registration/register` в формате XML.
- В случае успеха — редирект на форму авторизации.

---

## 2. Авторизация пользователя

### Где:
- Страница входа: `login.html`

### Что делает пользователь:
1. Вводит логин и пароль.
2. Нажимает **"Войти"**.

### Что происходит:
- Отправляется POST-запрос на `api/authorization/authorize` (JSON).
- Если пользователь — `admin`, редирект на `/admin/index.html`.
- Если обычный пользователь — редирект на `/index.html`.
- Полученный `userId` сохраняется в `localStorage`.

---

## 3. Подача заявки

### Где:
- Страница подачи заявки: `index.html`

### Что делает пользователь:
1. Вводит данные:
   - ФИО
   - Email
   - Телефон
   - Тип услуги
   - Комментарий
2. Прикрепляет один или несколько файлов.
3. Нажимает **"Отправить заявку"**.

### Что происходит:
- Формируется `multipart/form-data` запрос.
- Отправляется на `POST /api/applications`.
- Сервер:
  - сохраняет файлы в `/uploads/`.
  - формирует XML с внедрённым CSS.
  - сохраняет XML и путь в БД.
- Отображается сообщение об успешной отправке.

---

## 4. Просмотр своих заявок

### Где:
- Страница заявок на `index.html`.

### Что делает пользователь:
- После входа данные пользователя автоматически загружаются.
- Пользователь видит список своих заявок с полями:
  - Дата
  - Статус
  - Ссылки на XML-документ
  - Список приложенных файлов.

### Что происходит:
- `GET /api/applications/{userId}` запрашивает список заявок по ID.

---

## 5. Администрирование заявок

### Где:
- Страница администратора: `/admin/index.html`

### Что делает администратор:
1. Входит с логином/паролем `admin/admin`.
2. Видит список всех заявок.
3. Может:
   - Изменять статус (`Новая`, `В работе`, `Завершена`).
   - Загрузить откорректированный XML.
   - Скачать файлы.

### Что происходит:
- `POST /api/admin/updatestatus/{applicationId}` — обновляет статус и XML.

---

## Хранилище данных

**База данных** включает таблицы:
- `Users` — данные зарегистрированных пользователей
- `Applications` — заявки (включая путь к XML и список файлов)

---

## Используемые технологии

| Компонент          | Технология                     |
|--------------------|-------------------------------|
| Сервер             | ASP.NET Core Web API          |
| Фронтенд           | HTML, CSS, JavaScript         |
| База данных        | Entity Framework Core + PostgreSQL |
| Авторизация        | Простая логика без JWT        |
| Хэширование паролей| SHA256                        |
| XML-документы      | System.Xml.Linq               |

---

## Безопасность

- Пароли не хранятся в открытом виде.
- Все действия валидируются на сервере.


# Инструкция для разработчика

## Описание проекта

Проект представляет собой систему для подачи и обработки заявок с использованием ASP.NET Core Web API и простого HTML/JS интерфейса для взаимодействия с пользователем и администратором.

Проект включает:
- Back-end на **ASP.NET Core Web API** для обработки заявок, регистрации пользователей, авторизации и административной панели.
- Front-end на **HTML**, **CSS** и **JavaScript** для пользовательского интерфейса и панели администратора.

---

## Архитектура проекта

### 1. Структура Back-end

- **Контроллеры**:
  - `RegistrationController`: Обрабатывает регистрацию пользователей.
  - `AuthorizationController`: Обрабатывает авторизацию пользователей.
  - `ApplicationsController`: Обрабатывает подачу заявок пользователями.
  - `AdminController`: Административные операции, такие как обновление статуса заявки.

- **Модели**:
  - `User`: Представление пользователя в системе.
  - `Application`: Представление заявки с привязкой к пользователю.
  - `ApplicationStatus`: Перечисление статусов заявок (Новая, В работе, Завершена).
  - `RegistrationRequest`, `AuthorizationRequest`, `ApplicationRequest`, `UpdateStatusRequest`: Модели для обработки входных данных.

- **Контекст данных**:
  - Используется **Entity Framework Core** для работы с базой данных. Данные о пользователях и заявках хранятся в таблицах **Users** и **Applications**.

### 2. Структура Front-end

- **index.html** — личный кабинет пользователя.
- **login.html** — страница входа.
- **register.html** — страница регистрации.
- **addApplication.html** — страница для подачи заявок пользователем.
- **admin/index.html** — интерфейс для работы администратора.
- **js/register.js** — логика регистрации.
- **js/login.js** — логика авторизации.
- **js/addApplication.js** — логика подачи заявок пользователем.
- **js/admin.js** — логика для работы админа с заявками.
- **css/style.css** — общий стиль для пользовательского интерфейса.
- **css/xmlstyle.css** — стиль для встраивания в XML-документы.
- **css/admin.css** — стиль для интерфейса администратора.

---

## Структура кода

### 1. Контроллеры

- **RegistrationController**:
  Обрабатывает регистрацию пользователей, проверяя уникальность логина и хэшируя пароль. Использует XML для обработки запросов регистрации.

- **AuthorizationController**:
  Обрабатывает авторизацию пользователей, проверяя логин и пароль. В случае успешной авторизации возвращает информацию о пользователе.

- **ApplicationsController**:
  Обрабатывает подачу заявок, сохранение файлов и создание XML-документов. Возвращает информацию о заявке.

- **AdminController**:
  Обрабатывает операции администратора, такие как обновление статуса заявки и загрузка изменённых XML.

### 2. Модели

- **ApplicationRequest**: Модель для запроса подачи заявки.
- **AuthorizationRequest**: Модель для запроса авторизации.
- **RegistrationRequest**: Модель для запроса регистрации.
- **UpdateStatusRequest**: Модель для обновления статуса заявки.

Модели используют атрибуты **Required** для обязательных полей и **XmlElement** для работы с XML.

---

## Взаимодействие между компонентами

- **Регистрация и авторизация**:
  - Фронтенд отправляет запросы на сервер для регистрации и авторизации пользователей.
  - Бэкенд обрабатывает запросы, хэширует пароли, сохраняет данные в базу данных и возвращает статусы.

- **Подача заявки**:
  - Пользователь заполняет форму и прикрепляет файлы.
  - Сервер принимает данные, сохраняет файлы, генерирует XML-документ и сохраняет все в базе.

- **Администрирование**:
  - Администратор может просматривать список заявок и обновлять их статусы.
  - Изменённые данные сохраняются в базе данных и отображаются на панели администрирования.

---

## Структура данных

**Users Table**:

- `Id` (Guid): Уникальный идентификатор пользователя.
- `Fullname` (string): Полное имя.
- `Email` (string): Электронная почта.
- `Phone` (string): Номер телефона.
- `Address` (string): Адрес.
- `Placeofwork` (string): Место работы.
- `Login` (string): Логин пользователя.
- `Passwordhash` (string): Хэш пароля.

**Applications Table**:

- `Id` (Guid): Уникальный идентификатор заявки.
- `Userid` (Guid): Идентификатор пользователя, подавшего заявку.
- `Fullname` (string): Полное имя пользователя.
- `Email` (string): Электронная почта.
- `Phone` (string): Номер телефона.
- `Servicetype` (string): Тип услуги.
- `Description` (string): Описание заявки.
- `Status` (Enum.ApplicationStatus): Статус заявки (Новая, В работе, Завершена).
- `Createdat` (DateTime): Дата создания заявки.
- `Xmlpath` (string): Путь к XML-файлу заявки.
- `Files` (List<string>): Список файлов, прикреплённых к заявке.

---

## Важные моменты

- **Безопасность**:
  - Пароли хранятся в базе в хэшированном виде с использованием **SHA256**.

- **Файлы**:
  - Все загруженные файлы сохраняются в папку `/uploads/`.
  - XML-документы генерируются с использованием **System.Xml.Linq** и встроенным стилем.

- **CSS в XML**:
  - Встраиваемый стиль для XML-документов находится в файле `wwwroot/css/xmlstyle.css`. Этот стиль применяется ко всем созданным XML-документам.

---

## Зависимости

- **.NET 8.0** и выше.
- **Entity Framework Core** для работы с базой данных.
- **SHA256** для хэширования паролей.